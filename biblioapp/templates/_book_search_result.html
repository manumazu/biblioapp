{% if not book %}
	<!-- book not found in ocr analyze -->
	<li class="list-group-item">
		No result for this search "{{ search }}" <button class="btn btn-sm btn-secondary">cancel indexation</button>
	</li>

{% else %}

	<!-- book is found in ocr, display forms -->
	{% set css_class = "" %}
	{% set message = "" %}
	{% if book['address'] %}
		{% if numshelf|int != book['address']['row']|int or app_id|int != book['address']['id_app']|int%}
			{% set css_class = "list-group-item-warning" %}
			{% if numshelf|int != book['address']['row']|int %}
				{% set message %} 
					Book is already in bookshelf but in another shelf n°{{ book['address']['row'] }}, with id {{ book['id'] }} at position n° {{ book['address']['position'] }} and LED n°{{ book['address']['led_column'] }}
				{% endset %}
			{% elif app_id|int != book['address']['id_app']|int %}
				{% set message %}
					Book is in another bookshelf "{{ book['address']['arduino_name'] }}", shelf n°{{ book['address']['row'] }}, with id {{ book['id'] }} at position n° {{ book['address']['position'] }} and LED n°{{ book['address']['led_column'] }}
				{% endset %}
			{% endif %}			
		{% else %}
			{% set css_class = "list-group-item-success" %}
			{% set message %}
				found in shelf n°{{ book['address']['row'] }}, with id {{ book['id'] }} at position n° {{ book['address']['position'] }} and LED n°{{ book['address']['led_column'] }}
			{% endset %}		
		{% endif %}
	{% endif %}

	{%- set book_id -%}
		{%- if book['found'] == 'local' -%}
			{%- if book['address'] -%}
				indexed_{{ book['id'] }}
			{%- else -%}
				book_{{ book['id'] }}
			{%- endif -%}
		{%- else -%}
			newbook_{{ numbook }}		
		{%- endif -%}
	{%- endset -%}

	<li class="list-group-item {{ css_class }}" {% if numbook %}id="{{ book_id }}"{% endif %}>
	<!-- display form for found book in search api result -->
	{% if book['found'] %}
	<form method="post" action="/bookreferencer/">
		{% if book['found'] == 'local' %}
			<input type="hidden" name="id" value="{{ book['id'] }}">
		{% endif %}
		<input type="hidden" name="title" value="{{ book['title'] }}">
		<input type="hidden" name="editor" value="{{ book['editor'] }}">
		<input type="hidden" name="pages" value="{{ book['pages'] }}">
		<input type="hidden" name="year" value="{{ book['year'] }}">
		<input type="hidden" name="description" value="{{book['description']}}">
		<input type="hidden" name="reference" value="{{ book['reference'] }}">
	{% else %}
	<!-- form to search again -->
	<form method="post" action="/booksearch/">
		<input type="hidden" name="intitle" value="{{ book['title'] }}">
	{% endif %}

	{% if numbook %}
		{{ numbook }}-
	{% endif %}

	{% if 'authors' in book %}
	  {% for author in book['authors'] %}
	    {{ author }}, 
	    <input type="hidden" name="authors[]" value="{{ author }}">
	  {% endfor %}
	{% endif %}

	{% if book['found'] %}
		{% if book['address'] %}
			<!-- display force position for book already in current shelf -->
			"{{ book['title'] }}": {{ message }}
		{% else %}
			<!-- display url for edition -->
			{% if book['found'] == 'local' %}
				<i><a href="{{ url_for('getBook', book_id=book['id']) }}">{{ book['title'] }}</a></i>, {{ book['editor'] }} ({{ book['year'] }}, {{ book['pages'] }}p) - [Already in the index]
			{% else %}
				<i><a href="{{ url_for('searchBookReference') }}?ref={{ book['reference'] }}">{{ book['title'] }}</a></i>, {{ book['editor'] }} ({{ book['year'] }}, {{ book['pages'] }}p)
			{% endif %}
		{% endif %}
	{% else %}
		<i style="color:#aaa">{{ book['title'] }}</i> - {{ book['editor'] }} 
	{% endif %}

	{% if field and 'categories' in field['volumeInfo'] %} -
	    {% for category in field['volumeInfo']['categories'] %}
		<input type="hidden" name="tags" value="{{ category }}">
		{{ category }}
	    {% endfor %}
	{% endif %}

	 {% if 'isbn' in book %}
	  	<input type="hidden" name="isbn" value="{{ book['isbn'] }}">
	  	<!--ISBN : {{ book['isbn'] }}-->
	  {% endif %}

	{% if book['found'] %}
		{% if book['address'] %}
			<!-- display button for changing position -->
			{% if numshelf|int != book['address']['row']|int or app_id|int != book['address']['id_app']|int %}
				<button class="btn btn-primary btn-sm" onClick="saveBook('{{ book_id }}', {{ numbook }}, {{ numshelf }})">Update position</button>
				<button class="btn btn-sm btn-secondary" {% if numbook %}onClick="doNotIndex('{{ book_id }}')"{% endif %}>cancel</button>
			{% endif %}
		{% else %}
			<!-- display button for saving book + postion -->
			<input type="submit" class="btn btn-primary btn-sm" {% if numbook %}onClick="saveBook('{{ book_id }}', {{ numbook }}, {{ numshelf }})"{% endif %} value="add this book !">
			{% if numbook %}<button class="btn btn-sm btn-secondary" {% if numbook %}onClick="doNotIndex('{{ book_id }}')"{% endif %}>do not index</button>{% endif %}
		{% endif %}
	{% else %}
		<!-- book not found in search api result -->
		<button type="submit" class="btn btn-warning btn-sm" {% if numbook %}onClick="searchBook('{{ book_id }}', {{ numshelf }})"{% endif %}>search again...</button>
		<button class="btn btn-sm btn-secondary" {% if numbook %}onClick="doNotIndex('{{ book_id }}')"{% endif %}>do not index</button>
	{% endif %}
	</form>
	</li>

{% endif %}